{"bean": {
   "nonvisualchildren": "",
   "controller": {
      "dependency": {
         "internal": [],
         "custom": []
      },
      "scss": "",
      "function": [
         {
            "argument": ["arr"],
            "name": "duration",
            "id": "43C3B29A-9A60-F226-6D7D-49888F92295B",
            "body": "function toMin(duration:string):number {\n    if (duration == null || !duration.includes(\":\")) {\n        console.debug(\"toMin: duraction not like hh:mm\", duration);\n        return 0\n    }\n    \n    const d = duration.split(\":\");\n    return parseInt(d[0])*60 + parseInt(d[1])\n}\n\nfunction toDuration(min:number):string {\n    return String(Math.floor(min/60)) + \":\" + String(min%60).padStart(2,'0') \n}\n\n\nconst minutes = arr.reduce((acc, value) => acc + toMin(value.duration), 0);\nreturn toDuration(minutes)",
            "type": "method"
         },
         {
            "argument": ["key"],
            "name": "renameSite",
            "id": "28B04299-8658-1833-EC3D-917B01B90A1A",
            "body": "console.group(\"renameSite: \", key);\nconst _that = this;\nconst alert = await this.Apperyio.getController(\"AlertController\").create({\n    header: `Rename Site`,\n    message: `Enter the new site name and confirm that you want to rename all your flights from ${key}`,\n    inputs: [{\n        name: 'newSitename',\n        type: 'text',\n        placeholder: 'New site name',\n        value: key\n    }],\n    buttons: [{\n        text: 'Cancel',\n        role: 'cancel',\n        cssClass: 'secondary',\n    }, {\n        text: 'Rename',\n        handler: async (res) => {\n            const newSitename = res.newSitename;\n            console.time('Load LogStorage');\n            //let logTable = await this.Apperyio.data.getStorage(\"LogStorage\");\n            let logTable = await this.Apperyio.data.getVariable(\"LogStorage\");\n            console.timeEnd('Load LogStorage');\n            logTable = logTable.map(({site: site, ...rest}) =>  \n                                         ({site: site == key ? newSitename : site, ...rest}));\n            _that.sites = _that.groupArrayOfObjects(logTable, \"site\"); //refresh cards\n            console.time('Save LogStorage');\n            await this.Apperyio.data.setStorage(\"LogStorage\", logTable);\n            await this.Apperyio.data.setVariable(\"LogStorage\", logTable);\n            console.timeEnd('Save LogStorage');\n        }\n    }]\n});\nawait alert.present();\nconsole.groupEnd();",
            "type": "async_method"
         },
         {
            "argument": [
               "list",
               "key"
            ],
            "name": "groupArrayOfObjects",
            "id": "DA8A72A8-D64F-E1F5-F4B2-FA0C8E0CE1DB",
            "body": "//https://www.codegrepper.com/code-examples/javascript/typescript+group+by+array\nreturn list.reduce(function(rv, x) {\n(rv[x[key]] = rv[x[key]] || []).push(x);\nreturn rv;\n}, {});\n\n",
            "type": "method"
         },
         {
            "argument": ["latlon"],
            "name": "invalidCoord",
            "id": "4C29B95A-59D7-CF48-C72D-9775B1B773F6",
            "body": "return latlon == null ||\n       latlon.Latitude  == null || \n       latlon.Longitude ==null ||\n       (latlon.Latitude  == 0 && latlon.Longitude == 0)",
            "type": "method"
         },
         {
            "argument": ["site"],
            "name": "update",
            "id": "66F5D78B-CC5B-6A7B-A551-37A2C44FA6A7",
            "body": "//Could not figure out how to do this as an marker event\n//currentItem is not captured.\n//Work around for tabs not woking with child with parameters\n//this.Apperyio.navigateTo(\"FlightDetails\", \"Update\", site._id);\nthis.Apperyio.data.setVariable(\"operation\", 'Update');\nthis.Apperyio.data.setVariable(\"id\",  site._id);\nthis.Apperyio.navigateTo(\"tabs/sites/flightdetails\");",
            "type": "method"
         }
      ],
      "module": {},
      "variable": [
         {
            "addDI": false,
            "name": "sites",
            "id": "73D76739-777A-0BE8-5CD3-5DC85AE59BAD",
            "type": "ADB7DD8B-612F-6E85-DA32-0D74E1330AA3",
            "value": "{}"
         },
         {
            "addDI": false,
            "name": "hideMaps",
            "id": "AC50D620-9E2F-0C31-6329-59154A525A11",
            "type": "ACB7DD8B-612F-6E85-DA32-0D74E1330AA2",
            "value": "true"
         }
      ]
   },
   "children": {"bean": [
      {
         "children": {"bean": [{
            "children": {"bean": [{
               "children": {"bean": [
                  {
                     "children": {"bean": []},
                     "@type": "Ionic5CardItemTitleBean",
                     "property": {
                        "mode": "",
                        "advancedProperties": {"Href": ""},
                        "color": "primary",
                        "className": "",
                        "wrapper": "ion-card-title",
                        "text": "{{item.key}}",
                        "componentName": "Title",
                        "aio_visible": "true"
                     },
                     "@id": "DAD8D1C5-E0FD-006C-1A04-87E14B6E83B4",
                     "events": ""
                  },
                  {
                     "children": {"bean": [{
                        "children": {"bean": []},
                        "@type": "Ionic5GoogleMapMarkerBean",
                        "property": {
                           "advancedProperties": {
                              "(markerClick)": "update(site)",
                              "title": "{{site.when}}",
                              "*ngFor": "let site of item.value"
                           },
                           "openInfoWindow": "false",
                           "addInfoWindow": "false",
                           "markerDraggable": "false",
                           "componentName": "SiteMarker",
                           "markerClickable": "true",
                           "coords": {
                              "latitude": "site.IGC.fixes[0].latitude",
                              "longitude": "site.IGC.fixes[0].longitude"
                           },
                           "aio_visible": "true"
                        },
                        "@id": "815720A8-46B5-3095-364A-723054906E3A",
                        "events": ""
                     }]},
                     "@type": "Ionic5GoogleMapBean",
                     "property": {
                        "center": {
                           "latitude": "item.value[0].IGC.fixes[0].latitude",
                           "longitude": "item.value[0].IGC.fixes[0].longitude"
                        },
                        "scrollwheel": "null",
                        "disableDoubleClickZoom": "false",
                        "fullscreenControl": "true",
                        "mapDraggable": "true",
                        "className": "",
                        "zoom": "15",
                        "slot": "",
                        "aio_visible": "true",
                        "advancedProperties": {"*ngIf": "item.value[0].IGC != null && !hideMaps"},
                        "mapTypeId": "hybrid",
                        "gestureHandling": "cooperative",
                        "zoomControl": "true",
                        "componentName": "GoogleMap1",
                        "visible": "true"
                     },
                     "@id": "99D17AC0-8C34-BAA9-09A8-9AA7A24D2E38",
                     "events": ""
                  },
                  {
                     "children": {"bean": []},
                     "@type": "Ionic5CardItemTitleBean",
                     "property": {
                        "mode": "",
                        "color": "",
                        "className": "",
                        "wrapper": "ion-card-subtitle",
                        "text": "{{item.value.length}} flights totaling {{duration(item.value)}} hrs",
                        "componentName": "SubTitle",
                        "aio_visible": "true"
                     },
                     "@id": "84729580-2E15-A3D7-07D1-339CC7DFF653",
                     "events": ""
                  },
                  {
                     "children": {"bean": []},
                     "@type": "Ionic5ButtonBean",
                     "property": {
                        "ion4Routing": {
                           "route": "",
                           "routerDirection": "",
                           "params": ""
                        },
                        "strong": "false",
                        "color": "medium",
                        "shape": "",
                        "icon": {
                           "style": "create-outline",
                           "name": "",
                           "color": "medium",
                           "className": "",
                           "slot": "icon-only",
                           "customIcon": "-1"
                        },
                        "className": "",
                        "slot": "",
                        "fill": "clear",
                        "aio_visible": "true",
                        "mode": "",
                        "advancedProperties": {"(click)": "renameSite(item.key)"},
                        "expand": "",
                        "component": "ion-button",
                        "buttonType": "",
                        "size": "small",
                        "ionMenuButton": {
                           "icon": "__default",
                           "autoHide": "",
                           "menu": "",
                           "customIcon": "-1",
                           "type": ""
                        },
                        "linkFeatures": {
                           "rel": "",
                           "href": "",
                           "type": "",
                           "target": ""
                        },
                        "disabled": "",
                        "text": "Rename",
                        "componentName": "RenameButton",
                        "ionBackButton": {
                           "defaultHref": "",
                           "icon": "__default",
                           "text": "",
                           "customIcon": "-1",
                           "type": ""
                        },
                        "styleBorderColor": "",
                        "styleBorderRadius": {
                           "all": "",
                           "topLeft": "",
                           "topRight": "",
                           "bottomLeft": "",
                           "bottomRight": ""
                        },
                        "styleBorderStyle": "",
                        "styleBorderWidth": {
                           "all": "",
                           "top": "",
                           "right": "",
                           "bottom": "",
                           "left": ""
                        },
                        "styleColor": "",
                        "styleMargin": {
                           "all": "",
                           "top": "",
                           "right": "",
                           "bottom": "",
                           "left": ""
                        },
                        "visible": "true"
                     },
                     "@id": "FA95F106-D195-34F0-4403-A811F72D895B",
                     "events": ""
                  }
               ]},
               "@type": "Ionic5CardItemBean",
               "property": {
                  "mode": "",
                  "translucent": "false",
                  "color": "",
                  "className": "",
                  "wrapper": "ion-card-content",
                  "text": "Item text",
                  "componentName": "CardItem1",
                  "aio_visible": "true",
                  "visible": "true"
               },
               "@id": "870CA6B9-87A8-CCE9-4540-161802E4510B",
               "events": ""
            }]},
            "@type": "Ionic5CardBean",
            "property": {
               "mode": "",
               "ion4Routing": {
                  "route": "",
                  "routerDirection": "",
                  "params": ""
               },
               "advancedProperties": {"*ngFor": "let item of sites | keyvalue"},
               "isButton": "false",
               "color": "",
               "linkFeatures": {
                  "rel": "",
                  "href": "",
                  "type": "",
                  "target": ""
               },
               "className": "ion-no-margin",
               "disabled": "",
               "slot": "",
               "componentName": "SiteCard",
               "aio_visible": "true",
               "visible": "true"
            },
            "@id": "F24DC960-A642-F9B3-34FC-93B3B05DCEBA",
            "events": ""
         }]},
         "@type": "Ionic5ContentBean",
         "property": {
            "advancedProperties": {"(ionScroll)": ""},
            "color": "",
            "fullscreen": "false",
            "forceOverscroll": "",
            "scrollY": "",
            "className": "ion-no-margin",
            "availableSlots": {
               "": "Not selected",
               "fixed": "Fixed"
            },
            "componentName": "Content1",
            "scrollEvents": "",
            "scrollX": "",
            "stylePadding": {
               "all": "",
               "top": "",
               "right": "",
               "bottom": "",
               "left": ""
            },
            "styleTextAlign": "",
            "": ""
         },
         "@id": "81336DBF-DCE2-9430-485C-4F5D7302694E",
         "events": ""
      },
      {
         "children": {"bean": [{
            "children": {"bean": [
               {
                  "children": {"bean": [
                     {
                        "children": {"bean": []},
                        "@type": "Ionic5ButtonBean",
                        "property": {
                           "ion4Routing": {
                              "route": "",
                              "routerDirection": "",
                              "params": ""
                           },
                           "strong": "false",
                           "color": "",
                           "shape": "",
                           "icon": {
                              "color": "",
                              "name": "",
                              "style": "none",
                              "className": "",
                              "slot": "",
                              "customIcon": "-1"
                           },
                           "className": "",
                           "slot": "",
                           "fill": "",
                           "aio_visible": "true",
                           "mode": "",
                           "advancedProperties": {"(click)": ""},
                           "expand": "block",
                           "component": "ion-menu-button",
                           "buttonType": "",
                           "size": "",
                           "ionMenuButton": {
                              "icon": "__default",
                              "autoHide": "",
                              "menu": "",
                              "customIcon": "-1",
                              "type": ""
                           },
                           "linkFeatures": {
                              "rel": "",
                              "href": "",
                              "type": "",
                              "target": ""
                           },
                           "disabled": "",
                           "text": "Button",
                           "componentName": "MenuButton",
                           "ionBackButton": {
                              "defaultHref": "",
                              "icon": "__default",
                              "text": "",
                              "customIcon": "-1",
                              "type": ""
                           },
                           "styleBorderColor": "",
                           "styleBorderRadius": {
                              "all": "",
                              "topLeft": "",
                              "topRight": "",
                              "bottomLeft": "",
                              "bottomRight": ""
                           },
                           "styleBorderStyle": "",
                           "styleBorderWidth": {
                              "all": "",
                              "top": "",
                              "right": "",
                              "bottom": "",
                              "left": ""
                           },
                           "styleColor": "",
                           "styleMargin": {
                              "all": "",
                              "top": "",
                              "right": "",
                              "bottom": "",
                              "left": ""
                           },
                           "visible": "true"
                        },
                        "@id": "2E081F38-DA74-9258-0883-5276D00677F2",
                        "events": ""
                     },
                     {
                        "children": {"bean": []},
                        "@type": "Ionic5ButtonBean",
                        "property": {
                           "ion4Routing": {
                              "route": "",
                              "routerDirection": "",
                              "params": ""
                           },
                           "strong": "false",
                           "color": "",
                           "shape": "",
                           "icon": {
                              "color": "",
                              "name": "",
                              "style": "none",
                              "className": "",
                              "slot": "",
                              "customIcon": "-1"
                           },
                           "className": "",
                           "slot": "",
                           "fill": "",
                           "aio_visible": "true",
                           "mode": "",
                           "advancedProperties": {
                              "(click)": "",
                              "title": "Go back"
                           },
                           "expand": "block",
                           "component": "ion-back-button",
                           "buttonType": "",
                           "size": "",
                           "ionMenuButton": {
                              "icon": "__default",
                              "autoHide": "",
                              "menu": "",
                              "customIcon": "-1",
                              "type": ""
                           },
                           "linkFeatures": {
                              "rel": "",
                              "href": "",
                              "type": "",
                              "target": ""
                           },
                           "disabled": "",
                           "text": "Button",
                           "componentName": "BackButton",
                           "ionBackButton": {
                              "defaultHref": "",
                              "icon": "__default",
                              "text": "",
                              "customIcon": "-1",
                              "type": ""
                           },
                           "styleBorderColor": "",
                           "styleBorderRadius": {
                              "all": "",
                              "topLeft": "",
                              "topRight": "",
                              "bottomLeft": "",
                              "bottomRight": ""
                           },
                           "styleBorderStyle": "",
                           "styleBorderWidth": {
                              "all": "",
                              "top": "",
                              "right": "",
                              "bottom": "",
                              "left": ""
                           },
                           "styleColor": "",
                           "styleMargin": {
                              "all": "",
                              "top": "",
                              "right": "",
                              "bottom": "",
                              "left": ""
                           },
                           "visible": "true"
                        },
                        "@id": "68E7E1D2-9359-51CB-654E-AB6C2938FDD0",
                        "events": ""
                     },
                     {
                        "children": {"bean": []},
                        "@type": "Ionic5ButtonBean",
                        "property": {
                           "ion4Routing": {
                              "route": "",
                              "routerDirection": "",
                              "params": ""
                           },
                           "strong": "false",
                           "color": "",
                           "shape": "",
                           "icon": {
                              "color": "",
                              "name": "",
                              "style": "none",
                              "className": "",
                              "slot": "",
                              "customIcon": 17738676
                           },
                           "className": "",
                           "slot": "",
                           "fill": "",
                           "aio_visible": "true",
                           "mode": "",
                           "advancedProperties": {
                              "(click)": "hideMaps = !hideMaps",
                              "title": "Show/Hide Maps"
                           },
                           "expand": "block",
                           "component": "ion-button",
                           "buttonType": "",
                           "size": "",
                           "ionMenuButton": {
                              "icon": "__default",
                              "autoHide": "",
                              "menu": "",
                              "customIcon": "-1",
                              "type": ""
                           },
                           "linkFeatures": {
                              "rel": "",
                              "href": "",
                              "type": "",
                              "target": ""
                           },
                           "disabled": "",
                           "text": "",
                           "componentName": "Button4",
                           "ionBackButton": {
                              "defaultHref": "",
                              "icon": "__default",
                              "text": "",
                              "customIcon": "-1",
                              "type": ""
                           },
                           "styleBorderColor": "",
                           "styleBorderRadius": {
                              "all": "",
                              "topLeft": "",
                              "topRight": "",
                              "bottomLeft": "",
                              "bottomRight": ""
                           },
                           "styleBorderStyle": "",
                           "styleBorderWidth": {
                              "all": "",
                              "top": "",
                              "right": "",
                              "bottom": "",
                              "left": ""
                           },
                           "styleColor": "",
                           "styleMargin": {
                              "all": "",
                              "top": "",
                              "right": "",
                              "bottom": "",
                              "left": ""
                           },
                           "visible": "true"
                        },
                        "@id": "A76E4E3E-9558-F6B7-2B66-1BE9497688A9",
                        "events": ""
                     }
                  ]},
                  "@type": "Ionic5ToolbarButtonsBean",
                  "property": {
                     "className": "",
                     "slot": "start",
                     "componentName": "ToolbarButtons1",
                     "aio_visible": "true",
                     "collapse": "true"
                  },
                  "@id": "44227511-CC1D-E34C-55A8-97556AE2AFF6",
                  "events": ""
               },
               {
                  "children": {"bean": []},
                  "@type": "Ionic5ToolbarTitleBean",
                  "property": {
                     "color": "primary",
                     "className": "",
                     "text": "Sites",
                     "componentName": "ToolbarTitle1",
                     "aio_visible": "true",
                     "size": ""
                  },
                  "@id": "2B54C766-242D-6904-2340-2C8D314B3CFB",
                  "events": ""
               }
            ]},
            "@type": "Ionic5ToolbarBean",
            "property": {
               "mode": "",
               "isTitle": "true",
               "color": "",
               "className": "",
               "availableSlots": {
                  "": "Not selected",
                  "secondary": "Secondary",
                  "start": "Start",
                  "end": "End",
                  "primary": "Primary"
               },
               "slot": "",
               "componentName": "Toolbar1",
               "aio_visible": "true",
               "visible": "true"
            },
            "@id": "3F66DEA1-F8E1-85FA-CB8F-CB16E41884A1",
            "events": ""
         }]},
         "@type": "Ionic5HeaderBean",
         "property": {
            "mode": "",
            "translucent": "false",
            "className": "",
            "noBorder": "false",
            "componentName": "Header1",
            "aio_visible": "true"
         },
         "@id": "D93331EF-95D9-4188-A961-8A5CEDD71C7D",
         "events": ""
      }
   ]},
   "@type": "MobileScreenBean",
   "property": {
      "isTabs": "false",
      "platformMode": "md",
      "showHeader": "true",
      "theme": "",
      "componentName": "Page",
      "showFooter": "false",
      "isModal": "false"
   },
   "@id": "8C1361DD-403C-E153-7DA0-303F0E16D02A",
   "events": {"ionViewWillEnter": {
      "@id": "",
      "@readOnly": "false",
      "actions": {"customjs": {
         "@readOnly": false,
         "@index": 0,
         "@id": "CustomJSAction98498",
         "isActive": true,
         "script": "console.group(\"Before page showing - Sites\");\nconsole.time(\"Loading LogStorage\");\n//const logTable = await this.Apperyio.data.getStorage(\"LogStorage\");\nconst logTable = await this.Apperyio.data.getVariable(\"LogStorage\");\nconsole.timeEnd(\"Loading LogStorage\");\nthis.sites = this.groupArrayOfObjects(logTable, \"site\");\nconsole.groupEnd();\n\n"
      }}
   }}
}}